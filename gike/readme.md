# Модуль мониторинга историко-культурных экспертиз КГИОП

Этот скрипт автоматически проверяет появление новых историко-культурных экспертиз на сайте КГИОП Санкт-Петербурга (https://kgiop.gov.spb.ru/), загружает их, извлекает ключевую информацию и сохраняет в базу данных с кратким пересказом с использованием ИИ.

Предназначен только для образовательных целей. 

## Основные функции

- Автоматический мониторинг новых экспертиз на сайте КГИОП
- Загрузка PDF-документов (как с сайта КГИОП, так и с Яндекс.Диска)
- Оптическое распознавание текста (OCR) для сканированных документов
- Извлечение ключевых фрагментов текста по заданным ключевым словам
- Генерация краткого пересказа с использованием модели GPT4All
- Хранение данных в SQLite базе данных
- Автоматическое поддержание размера базы (1000 последних записей)
- Генерация HTML-отчета со всеми экспертизами

## Требования

- Python 3.8+
- Установленные зависимости из `requirements.txt`
- Локально установленная модель GPT4All (указывается в `user_data.py`)
- Для работы распознавания PDF необходимо, чтобы были установлен tesseract и ghostscript, подробнее см. [на странице библиотеки ocrmypdf](https://ocrmypdf.readthedocs.io/en/latest/installation.html).

## Установка

1. Клонируйте репозиторий
2. Установите зависимости:
   ```bash
   pip install -r requirements.txt

# Настройка

Создайте файл user_data.py со следующим содержимым:
```python
# Путь к модели GPT4All
model_path = "путь/к/вашей/модели"
```
# Использование

Просто запустите скрипт:
```bash
python kgiop_monitor.py
```

Скрипт будет:

1. Проверять новые экспертизы на сайте КГИОП
2. Загружать новые документы
3. Обрабатывать их и сохранять в базу данных
4. Генерировать HTML-отчет db_html.html

# Особенности работы

1. Скрипт обрабатывает до 20 новых экспертиз за один запуск
2. Для каждого документа создается краткое описание с помощью ИИ
3. Поддерживаются документы как с сайта КГИОП, так и с Яндекс.Диска
4. Автоматически выполняется OCR для сканированных документов
5. База данных автоматически очищается, оставляя 1000 последних записей

# Структура базы данных

Таблица kgiop содержит следующие поля:

1. date - дата добавления записи
2. link - ссылка на оригинальный документ
3. summary - краткое описание, сгенерированное ИИ
4. text - полный текст документа (после OCR при необходимости)

# Ключевые слова для анализа

Скрипт ищет в тексте следующие ключевые слова для составления выжимки:

1. "предусматривает"
2. "проектом"
3. "собственник"
4. "заказчик"
5. "вывод"